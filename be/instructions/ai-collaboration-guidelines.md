# AI 협업 가이드라인

이 문서는 AI가 백엔드 개발을 수행할 때 지켜야 할 협업 원칙과 주의사항을 정의합니다.

## 핵심 원칙

### 1. 솔직한 소통
- **모르는 것은 솔직하게 인정**: 추측하거나 가정하지 않고 명확히 질문
- **확실하지 않은 정보는 사용 금지**: 기존 코드 패턴을 추측하지 말고 실제 확인 후 적용
- **투명한 작업 진행 상황 공유**: 현재 단계와 다음 작업 계획을 명확히 전달

### 2. 토큰 효율성 고려
- **작업 단위 분할**: 대화 맥락이 길어지지 않도록 적절한 단위로 작업 분할
- **불필요한 출력 최소화**: 긴 로그나 반복적인 내용 출력 지양
- **집중적인 작업 수행**: 한 번에 하나의 명확한 목표에 집중

### 3. 기존 규칙 엄격 준수
- **워크플로우 준수**: workflow.md의 단계별 개발 프로세스 엄격 이행
- **레이어별 개발**: 절대 버티컬 슬라이스 방식 사용 금지
- **테스트 방식**: run configuration만 사용, gradle 직접 실행 금지

## 작업 진행 방식

### 1. 작업 시작 전 확인 사항
```markdown
✅ 필수 문서 읽기 완료
✅ 현재 진행 단계 파악
✅ 기존 코드 패턴 확인
✅ 작업 범위 명확화
```

### 2. 코드 작성 시 주의사항
- **기존 패턴 준수**: 추측하지 말고 실제 코드에서 패턴 확인
- **네이밍 규칙 일관성**: naming-conventions.md 엄격 준수
- **테스트 코드 동시 작성**: 기능 구현과 테스트 코드를 함께 작성

### 3. 테스트 실행 방식
- **도구 사용 순서**:
  1. `get_run_configurations` - 사용 가능한 설정 확인
  2. `run_configuration` - 적절한 설정으로 테스트 실행
- **금지사항**:
  - `execute_terminal_command`로 gradle 테스트 실행
  - `./gradlew test` 등 직접 gradle 명령어 사용

### 4. Git 작업 시 주의사항
- **git 명령어 실행 시 `--no-pager` 옵션 필수 사용**
- **커밋 메시지 규칙 준수**: 프로젝트 컨벤션에 맞는 커밋 메시지 작성
- **변경사항 확인**: `get_project_vcs_status`로 변경 파일 확인 후 커밋

## 대화 관리

### 1. 단계별 승인 요청
- 각 개발 단계 완료 후 반드시 사용자 승인 요청
- 다음 단계 진행 전 현재 상황 요약 제공
- 예상 작업 시간 및 토큰 사용량 고려사항 공유

### 2. 문제 상황 대처
- **예상치 못한 오류 발생**: 즉시 사용자에게 상황 보고
- **기존 규칙과 충돌**: 사용자와 조율 후 진행 방향 결정
- **작업 범위 초과**: 작업 분할 제안 또는 우선순위 조정 요청

### 3. 효율적인 소통
- **간결하고 명확한 응답**: 불필요한 설명 최소화
- **구체적인 질문**: 모호한 질문보다 구체적이고 선택지가 있는 질문
- **진행 상황 투명성**: 현재 어떤 작업을 하고 있는지 명확히 전달

## 품질 관리

### 1. 코드 품질 기준
- **아키텍처 일관성**: 기존 아키텍처 패턴 준수
- **테스트 커버리지**: 모든 기능에 대한 적절한 테스트 작성
- **문서화**: JavaDoc 및 필요한 주석 작성

### 2. 검증 절차
- **단계별 테스트 실행**: 각 단계 완료 후 관련 테스트 실행
- **기존 테스트 영향도 확인**: 새로운 변경이 기존 테스트에 미치는 영향 검증
- **통합 테스트**: 여러 계층이 연동되는 기능의 통합 테스트 수행

## 예외 상황 처리

### 1. 규칙 충돌 상황
- 여러 가이드라인이 충돌하는 경우: 사용자와 우선순위 협의
- 기술적 제약으로 인한 규칙 위반: 대안 제시 및 승인 요청

### 2. 긴급 상황
- 심각한 오류 발견: 즉시 작업 중단 및 상황 보고
- 데이터 손실 위험: 백업 및 복구 방안 우선 확인

## 인수인계서 작성 지침

### 1. 인수인계서의 목적
- **세션 간 연속성 보장**: AI는 대화 간 정보를 보존하지 않으므로 명확한 인수인계 필수
- **토큰 효율성 극대화**: 반복 작업 최소화로 개발 생산성 향상
- **워크플로우 준수 강제**: 새로운 AI가 올바른 절차를 따르도록 안내

### 2. 세션 구분 및 상태 관리

#### A. 세션 정보 명시
```markdown
# [기능명] 개발 인수인계 문서
**세션 ID**: 20241224-003
**이전 세션**: 20241223-001, 20241223-002
**작성자**: AI Assistant
**작성일시**: 2024-12-24 15:30
```

#### B. 작업 상태 구분
```markdown
## 📊 개발 현황 (세션별 구분)

### ✅ 완료된 작업 (이전 세션들)
- **1단계: 코어 계층** (세션 20241223-001에서 완료)
  - [ ] UseCase 인터페이스 구현 ✅
  - [ ] Service 비즈니스 로직 구현 ✅
  - [ ] 단위 테스트 작성 및 통과 ✅

### 🔄 현재 세션 목표
- **3단계: 프레젠테이션 계층** (현재 세션에서 진행)
  - [ ] Controller 구현 (진행 중)
  - [ ] Response DTO 구현 (대기)
  - [ ] 인수 테스트 작성 (대기)
```

### 3. 새로운 AI를 위한 필수 절차

#### A. 워크플로우 규칙 강제 안내
```markdown
## 🚨 새로운 AI 세션 시작 시 필수 절차 (건너뛰기 엄격 금지)

### Step 1: 워크플로우 확인
- `be/instructions/workflow/workflow.md` 읽기 **필수**
- 아키텍트/개발자 AI 절차 확인 **필수**

### Step 2: 필수 문서 읽기 (순서대로)
**⚠️ 이전 세션에서 읽었더라도 새 세션에서는 다시 읽기 필수**

1. [ ] `be/instructions/index.md` 
2. [ ] `be/instructions/testing-guidelines.md`
3. [ ] `be/instructions/naming-conventions.md`
4. [ ] `be/instructions/architecture-overview.md`
5. [ ] `be/instructions/development-process.md`
6. [ ] `be/instructions/coding-standards.md`
7. [ ] `be/instructions/entity-mapping.md` (필요시)
8. [ ] `be/instructions/workflow/4_feat/[기능명].md`

### Step 3: 읽기 완료 확인 (필수 형식)
각 문서를 읽은 후 반드시 다음 형식으로 확인:
```
✅ 읽음 완료: [파일명] - [핵심 내용 1-2줄 요약]
```

### Step 4: 개발 시작 전 체크리스트
- [ ] 모든 필수 문서 읽기 완료
- [ ] 기존 완성 코드 확인 완료
- [ ] 현재 단계 목표 이해 완료
- [ ] 사용자 승인 후 개발 시작
```

#### B. 명확한 금지사항 명시
```markdown
## ❌ 절대 금지사항

### 워크플로우 위반
- 필수 문서 읽기 건너뛰기
- 단계별 개발 순서 무시 (버티컬 슬라이스 금지)
- 사용자 승인 없이 다음 단계 진행

### 추측 기반 개발
- 기존 코드 패턴을 보지 않고 추측으로 개발
- 확인하지 않은 정보로 코드 작성
- 불확실한 API나 메서드 사용
```

### 4. 컨텍스트 보존을 위한 상세 정보

#### A. 설계 결정사항 기록
```markdown
## 📋 이전 세션 설계 결정사항 (변경 금지)

### 기술적 결정사항
- **API 엔드포인트**: `GET /api/families/{familyId}/join-requests`
- **권한 검증 방식**: Service 계층에서 OWNER/ADMIN 권한 확인
- **응답 형식**: `FindFamilyJoinRequestResponse` 레코드 클래스 사용
- **명명 규칙**: Find 접두사 사용 (Get/Retrieve 사용 금지)

### 참고할 기존 코드 패턴
- **Controller 패턴**: `SaveFamilyJoinRequestController.java` 참고
- **인증 방식**: `@AuthFTUser FTUser ftUser` 패턴 사용
- **Response DTO**: record 클래스 + static from() 메서드 패턴
- **테스트 구조**: `FindFamilyMemberRoleAcceptanceTest.java` 참고
```

#### B. 함정 요소 및 주의사항
```markdown
## ⚠️ 주의사항 및 알려진 함정

### 코드 작성 시 주의사항
- **FTUser 생성**: 테스트에서 `FTUser.ofFormLoginUser()` 메서드 사용 필수
- **HTTP 상태코드**: 오타 주의 (`HttpStatus.NOT_Found` → `HttpStatus.NOT_FOUND`)
- **권한 검증**: MEMBER 권한은 403 Forbidden, 비구성원도 403 Forbidden

### 테스트 작성 시 주의사항
- **인수 테스트**
  - `@WithMockOAuth2User` + 실제 DB 엔티티 생성
- **단위 테스트**
  - Mock 객체 사용
- **테스트 실행**
  - run_configuration 사용
  - gradle test 태스크 직접 실행 금지

### 기존 코드 보호
- **1-2단계 완료 코드**: 절대 변경 금지
- **변경 필요시**: 반드시 사용자 승인 후 진행
- **의존성 영향**: 기존 테스트에 영향 주지 않도록 주의
```

### 5. 단계별 체크포인트 시스템

#### A. 진행 상황 추적
```markdown
## 🔄 현재 세션 진행 체크포인트

### 3단계: 프레젠테이션 계층 개발

#### 3-1. Controller 구현 (현재 단계)
- [ ] `FindFamilyJoinRequestController.java` 생성
- [ ] REST API 메서드 구현 (`@GetMapping`)
- [ ] JavaDoc 문서화 작성
- [ ] **체크포인트 1**: 사용자 승인 후 다음 단계 진행

#### 3-2. Response DTO 구현
- [ ] `FindFamilyJoinRequestResponse.java` 생성
- [ ] 중첩 레코드 클래스 구조 설계
- [ ] static from() 변환 메서드 구현
- [ ] **체크포인트 2**: 사용자 승인 후 다음 단계 진행

#### 3-3. 테스트 작성 및 검증
- [ ] 인수 테스트 작성 (`FindFamilyJoinRequestAcceptanceTest`)
- [ ] 단위 테스트 작성 (`FindFamilyJoinRequestControllerTest`)
- [ ] 모든 테스트 통과 확인
- [ ] **최종 체크포인트**: 전체 기능 완성 확인
```

### 6. 토큰 효율성 최적화

#### A. 문서 읽기 최적화
```markdown
## 💡 토큰 절약 전략

### 효율적인 문서 읽기
- **핵심 내용만 요약**: 각 문서당 2-3줄 요약으로 제한
- **중복 내용 생략**: "이전 문서와 동일한 패턴" 등으로 처리
- **변경사항 중심**: 새로운 내용이나 중요 변경사항만 상세 기록

### 코드 작성 최적화
- **사전 계획 수립**: 코드 작성 전 전체 구조 설계
- **한 번에 완성**: 수정 횟수 최소화를 위한 완성도 높은 코드 작성
- **테스트 우선**: TDD 방식으로 요구사항 명확화 후 구현
```

### 7. 인수인계서 업데이트 규칙

#### A. 세션 종료 시
```markdown
## 📝 세션 종료 시 인수인계서 업데이트

### 완료 작업 기록
- 현재 세션에서 완료한 작업을 "✅ 완료" 상태로 업데이트
- 생성된 파일 목록 및 주요 변경사항 기록
- 발견된 이슈나 주의사항 추가

### 다음 세션 준비
- 다음 세션에서 진행할 작업 명확히 정의
- 예상 소요 시간 및 복잡도 기록
- 필요한 사전 지식이나 참고 자료 명시
```

이 가이드라인은 AI와 개발자 간의 효율적이고 안전한 협업을 위해 지속적으로 업데이트됩니다.
